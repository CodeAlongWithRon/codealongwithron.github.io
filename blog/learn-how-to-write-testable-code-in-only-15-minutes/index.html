<!doctype html>
<html lang="en">
  <head>
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-179388238-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

  <meta charset="utf-8">
<title>Learn how to write testable code in C# in only 15 minutes - Code along with Ron</title>
<meta name="viewport" content="width=device-width, initial-scale=1">


  <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png?v=1">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png?v=1">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png?v=1">
  <link rel="manifest" href="/favicon/site.webmanifest?v=1">
  
    <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg?v=1" color="#ffffff">
    <link rel="shortcut icon" href="/favicon/favicon.ico?v=1">
    <meta name="msapplication-config" content="/favicon/browserconfig.xml?v=1">
  
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">

<meta name="generator" content="Hugo 0.74.3" /><meta itemprop="name" content="Learn how to write testable code in C# in only 15 minutes">
<meta itemprop="description" content="In this course I will teach you how to write code that is easy to test and how to create the tests themselves. And even better: it will only take you 15 minutes!">
<meta itemprop="datePublished" content="2020-09-19T20:55:12+02:00" />
<meta itemprop="dateModified" content="2020-09-19T20:55:12+02:00" />
<meta itemprop="wordCount" content="1245">



<meta itemprop="keywords" content="C#,Unit testing,Dependency injection,XUnit,Moq," />
<meta property="og:title" content="Learn how to write testable code in C# in only 15 minutes" />
<meta property="og:description" content="In this course I will teach you how to write code that is easy to test and how to create the tests themselves. And even better: it will only take you 15 minutes!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://codealongwithron.github.io/blog/learn-how-to-write-testable-code-in-only-15-minutes/" />
<meta property="article:published_time" content="2020-09-19T20:55:12+02:00" />
<meta property="article:modified_time" content="2020-09-19T20:55:12+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Learn how to write testable code in C# in only 15 minutes"/>
<meta name="twitter:description" content="In this course I will teach you how to write code that is easy to test and how to create the tests themselves. And even better: it will only take you 15 minutes!"/>
<link rel="stylesheet" href="/css/bundle.min.82b2a8eac446c665e1f5edb46f56a383cf5a4e0537f9abacd046b8b21389da7c.css" integrity="sha256-grKo6sRGxmXh9e20b1ajg89aTgU3&#43;aus0Ea4shOJ2nw="><link rel="stylesheet" href="/css/add-on.css">
</head>

  <body>
    
<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/" class="nav">
        
          Blog
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu menu">
      
        
          
          <a href="/" class="nav link"><i class='fa fa-home'></i> Home</a>
        
      
        
          
          <a href="/about/" class="nav link"><i class='far fa-id-card'></i> About</a>
        
      
        
          
          <a href="/blog/" class="nav link"><i class='far fa-newspaper'></i> Blog</a>
        
      
        
          
          <a href="/categories/" class="nav link"><i class='fas fa-sitemap'></i> Categories</a>
        
      
      <a href="#share-menu" class="nav link share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
      <a href="#search-input" class="nav link search-toggle"><i class="fas fa-search">&nbsp;</i>Search</a>
    </menu>
    <a href="#search-input" class="nav search-toggle"><i class="fas fa-search fa-2x">&nbsp;</i></a>
    <a href="#share-menu" class="nav share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
    
    <a href="#site-nav" class="nav nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="search" class="menu"><input id="search-input" class="search-input menu"></input><div id="search-results" class="search-results menu"></div></menu>
  
  
    <menu id="share-menu" class="flyout-menu menu">
      <h1>Share Post</h1>
      




  
    
    <a href="//twitter.com/share?text=Learn%20how%20to%20write%20testable%20code%20in%20C%23%20in%20only%2015%20minutes&amp;url=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f&amp;title=Learn%20how%20to%20write%20testable%20code%20in%20C%23%20in%20only%2015%20minutes" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f&amp;title=Learn%20how%20to%20write%20testable%20code%20in%20C%23%20in%20only%2015%20minutes" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f&amp;description=Learn%20how%20to%20write%20testable%20code%20in%20C%23%20in%20only%2015%20minutes" target="_blank" rel="noopener" class="nav share-btn pinterest">
          <p>Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by %7b%20%20%20%20%20%20%20%20map%5b%5d%7d&amp;body=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


    </menu>
  
</header>

    <div id="wrapper">
      <section id="site-intro" >
  <a href="/"><img src="https://codealongwithron.github.io/img/main/logo.jpg" class="circle" width="100" alt="Code along with Ron" /></a>
  <header>
    <h1>Code along with Ron</h1>
  </header>
  <main>
    <p>Teaching what I learned and learning as I teach</p>
  </main>
  
    <footer>
      <ul class="socnet-icons">
        

        <li><a href="//github.com/CodeAlongWithRon" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>



















<li><a href="//youtube.com/channel/UCJXeiLKL3B56LhdVUq8iIlw" target="_blank" rel="noopener" title="YouTube" class="fab fa-youtube"></a></li>





















      </ul>
    </footer>
  
</section>

      <main id="site-main">
        
  <article class="post">
    <header>
  <div class="title">
    
      <h2><a href="/blog/learn-how-to-write-testable-code-in-only-15-minutes/">Learn how to write testable code in C# in only 15 minutes</a></h2>
    
    
      <p>In this course I will teach you how to write code that is easy to test and how to create the tests themselves. And even better: it will only take you 15 minutes!</p>
    
  </div>
  <div class="meta">
    <time datetime="2020-09-19 20:55:12 &#43;0200 CEST">September 19, 2020</time>
    
    <p>6-Minute Read</p>
  </div>
</header>

    <div id="socnet-share">
      




  
    
    <a href="//twitter.com/share?text=Learn%20how%20to%20write%20testable%20code%20in%20C%23%20in%20only%2015%20minutes&amp;url=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f" target="_blank" rel="noopener" class="nav share-btn twitter">
        <p>Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f" target="_blank" rel="noopener" class="nav share-btn facebook">
        <p>Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f&amp;title=Learn%20how%20to%20write%20testable%20code%20in%20C%23%20in%20only%2015%20minutes" target="_blank" rel="noopener" class="nav share-btn reddit">
          <p>Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f&amp;title=Learn%20how%20to%20write%20testable%20code%20in%20C%23%20in%20only%2015%20minutes" target="_blank" rel="noopener" class="nav share-btn linkedin">
            <p>LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f&amp;description=Learn%20how%20to%20write%20testable%20code%20in%20C%23%20in%20only%2015%20minutes" target="_blank" rel="noopener" class="nav share-btn pinterest">
          <p>Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check%20out%20this%20post%20by %7b%20%20%20%20%20%20%20%20map%5b%5d%7d&amp;body=https%3a%2f%2fcodealongwithron.github.io%2fblog%2flearn-how-to-write-testable-code-in-only-15-minutes%2f" target="_blank" class="nav share-btn email" data-proofer-ignore>
          <p>Email</p>
        </a>
  


    </div>
    <div class="content">
      
      <h2 id="why-you-should-want-to-unit-test">Why you should want to unit test</h2>
<p>As an application grows, it becomes harder and harder to do manual testing. At some point the effort that goes into it simply becomes too much. The solution to this problem is automated testing. There are various types of automated tests, but in this course we will focus on unit tests.</p>
<p>In most cases unit tests are written by developers. Unit tests are called white box tests, because the developer knows the internal working of the application. The main benefit of unit tests is that they are very fast.</p>
<h2 id="tightly-coupled-code-is-not-suited-for-unit-testing">Tightly coupled code is not suited for unit testing</h2>
<p>One thing that is essential to unit testing is that the code must be written in a way that allows it to be tested. I will start off by showing an example of a class that was not written with testability in mind:</p>
<pre><code>public class ApiMonitoringRepository
{
   private static readonly HttpClient _httpClient = new HttpClient();

   public async Task&lt;HealthStatus&gt; IsHealthyAsync()
   {
      var response = await _httpClient.GetAsync(&quot;https://www.api.com&quot;);

      if (response.IsSuccessStatusCode)
      {
         return HealthStatus.Healthy;
      }

      return HealthStatus.Unhealthy;
   }
}

public enum HealthStatus
{
   Healthy,
   Unhealthy
}
</code></pre>
<p>What the method within this class does is performing a get request to an api. If the response status code is 2xx it returns a healthy status and otherwise it returns unhealthy. Pretty simple and purely looking at the functionality, it does what it&rsquo;s supposed to do. But what if we want to create unit tests for the two existing scenario&rsquo;s.</p>
<p>Because the class is tightly coupled to the HttpClient, it is impossible for us to have any control over the response of the get call. What we want to do, is move the execution of the get request to another class:</p>
<pre><code>public class ApiMonitoringClient
{
   private static readonly HttpClient _httpClient = new HttpClient();

   public async Task&lt;HttpResponseMessage&gt; GetResponseAsync()
   {
      return await _httpClient.GetAsync(&quot;https://www.api.com&quot;);
   }
}
</code></pre>
<p>We can then update the ApiMonitoringRepository to make it call the ApiMonitoringClient instead of directly using the HttpClient:</p>
<pre><code>public class ApiMonitoringRepository
{
   private static readonly ApiMonitoringClient _client = new ApiMonitoringClient();

   public async Task&lt;HealthStatus&gt; IsHealthyAsync()
   {
      var response = await _client.GetResponseAsync();

      if (response.IsSuccessStatusCode)
      {
         return HealthStatus.Healthy;
      }

      return HealthStatus.Unhealthy;
   }
}
</code></pre>
<p>Although we have improved the separation of the code, we are still tightly coupled. Before the coupling was with the HttpClient and now it is with the newly created ApiMonitoringClient. One thing to look out for when searching for tight coupling, is the creation of new objects. Both in the current as in the previous version of the repository an instance of an object is created by using the <em>new</em> keyword.</p>
<h2 id="how-to-make-the-code-loosely-coupled">How to make the code loosely coupled</h2>
<p>Now instead of creating an instance of the ApiMonitoringClient from within the repository, we will make use of dependency injection. In order to fully benefit from dependency injection, we want to make use of interfaces instead of concrete classes. Using interfaces makes it possible to supply mocks to the consumer of the interface. This gives us the control over the dependency that we are currently missing in our repository. The interface looks as follows:</p>
<pre><code>public interface IApiMonitoringClient
{
   Task&lt;HttpResponseMessage&gt; GetResponseAsync();
}
</code></pre>
<p>And the ApiMonitoringClient now implements the interface:</p>
<pre><code>public class ApiMonitoringClient : IApiMonitoringClient
</code></pre>
<p>We can now inject the newly created interface into the repository, resulting in the following variable and constructor changes:</p>
<pre><code>private readonly IApiMonitoringClient _client;

public ApiMonitoringRepository(IApiMonitoringClient client)
{
   _client = client;
}
</code></pre>
<p>If we created an actual application, we would have to register ApiMonitoringClient as the default implementation for the IApiMonitoringClient in a dependency injection container. Because the focus of this course is on unit testing, I will skip that part and continue with the creation of the unit tests.</p>
<h2 id="creating-the-unit-tests">Creating the unit tests</h2>
<p>My favorite unit testing framework is XUnit and my mocking framework of choice is Moq. You will see these frameworks being used in the code examples below. For the repository there are two scenario&rsquo;s that I would like to test:</p>
<ol>
<li>If the client returns a non success status code, does the repository return HealthStatus Unhealty?</li>
<li>If the client returns a success status code, does the repository return HealthStatus Healthy?</li>
</ol>
<p><strong>The notation that I use for the name of my unit tests is as follows:</strong></p>
<pre><code>SubjectUnderTest_TestScenario_ExpectedResult
</code></pre>
<p>So in case of the first test scenario that I defined, I would name the test:</p>
<pre><code>IsHealthy_ClientResponseWithNonSuccessStatusCode_ReturnsUnhealthyStatus
</code></pre>
<p>Next I start with following template for the test:</p>
<pre><code>[Fact]
public async Task IsHealthy_ClientResponseWithSuccessStatusCode_ReturnsHealthyStatus()
{
   // Arrange

   // Act

   // Assert
}
</code></pre>
<p><em>Fact</em> is an attribute that tells the test runner that it is a test that should be run. <em>Arrange</em> is where we organise whatever is needed before we run our tests. Usually this involves the generation of mocks. <em>Act</em> is where we perform the test. And lastly <em>Assert</em> is where we verify that the outcome of the test matches the expectation that we have.</p>
<p>Without further ado, let&rsquo;s create a unit test for our first test scenario:</p>
<pre><code>[Fact]
public async Task IsHealthy_ClientResponseWithSuccessStatusCode_ReturnsHealthyStatus()
{
   // Arrange
   var client = new Mock&lt;IApiMonitoringClient&gt;();
   var responseMessage = new HttpResponseMessage(HttpStatusCode.BadRequest);

   client
      .Setup(c =&gt; c.GetResponseAsync())
      .ReturnsAsync(responseMessage);

   var repository = new ApiMonitoringRepository(client.Object);

   // Act
   var result = await repository.IsHealthyAsync();

   // Assert
   Assert.Equal(HealthStatus.Unhealthy, result);
}
</code></pre>
<h3 id="arrange">Arrange</h3>
<p>What we want to achieve with this test, is to see if the repository correctly handles different responses from the client. In order to do this, we want to have control over the response from the client. We get this control, by creating a mock for the client. Once we have the mock, we create the response message that we want it to return. Because we want to test the scenario of a non success status code, we create a response message with a Bad Request status code. Although I chose Bad Request in this example, any other non success status code (like Internal Server Error for example) would have led to the same result.</p>
<p>Next we configure the mock by specifying which call we want to setup. In this case it is the <em>GetResponseAsync</em> method of the client. Then we specify what we want the method to return. That is the response message that we defined earlier.</p>
<p>The only thing remaining is to create an instance of the repository that we are testing. We do this by calling its constructor and providing the mock as argument.</p>
<h3 id="act">Act</h3>
<p>This one is easy. We simply execute the <em>IsHealthyAsync</em> method and assign its result to a variable.</p>
<h3 id="assert">Assert</h3>
<p>Last but not least, we verify that the value of the <em>result</em> variable equals HealthStatus Unhealthy.</p>
<p>Running the test results in our first passed test!</p>
<h2 id="the-next-test-is-up-to-you">The next test is up to you</h2>
<p>At this point, you should have enough knowledge to write a unit test for the second scenario. So instead of me showing you the code for this scenario, I would like to challenge you to write the test yourself. Think about the goal of the test, what you need to arrange to achieve this goal and then simply act and assert.</p>
<p>Feel free to share the test you have written with me. I&rsquo;m curious to see what you&rsquo;ve managed to create!</p>
<h2 id="conclusion">Conclusion</h2>
<p>Obviously there is more to unit testing than what I provided in this course. Regardless of that you will be able to test the majority of your code with the tips and techniques you learned in this course. If you have questions regarding unit testing that have not been answered in this course, I would love for you to reach out to me in the comment section below.</p>
    </div>
    <footer>
      <div class="stats">
  
    <ul class="categories">
      
        
          <li><a class="article-terms-link" href="/categories/c/">C#</a></li>
        
          <li><a class="article-terms-link" href="/categories/unit-testing/">Unit testing</a></li>
        
      
    </ul>
  
  
    <ul class="tags">
      
        
          <li><a class="article-terms-link" href="/tags/c/">C#</a></li>
        
          <li><a class="article-terms-link" href="/tags/unit-testing/">Unit testing</a></li>
        
          <li><a class="article-terms-link" href="/tags/dependency-injection/">Dependency injection</a></li>
        
          <li><a class="article-terms-link" href="/tags/xunit/">XUnit</a></li>
        
          <li><a class="article-terms-link" href="/tags/moq/">Moq</a></li>
        
      
    </ul>
  
</div>

    </footer>
  </article>
  
    

  
  <div class="pagination">
    
      <a href="/blog/youve-been-using-the-httpclient-incorrectly/" class="button left"><span>You&#39;ve been using the HttpClient incorrectly</span></a>
    
    
  </div>

      </main>
      <section id="site-sidebar">
  

  

  
</section>

      <footer id="site-footer">
  
      <ul class="socnet-icons">
        

        
      </ul>
  
  <p class="copyright">
    © 2020 Code along with Ron
      <br>
    
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      <script src="/js/highlight.js"></script>
    
    <script>hljs.initHighlightingOnLoad();</script><script src="/js/bundle.min.b4e669fa428a81defb8af0916c53f39cd1b8e0bbab22199c06f0b182907ba474.js" integrity="sha256-tOZp&#43;kKKgd77ivCRbFPznNG44LurIhmcBvCxgpB7pHQ="></script>
    <script src="/js/add-on.js"></script>
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-179388238-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    </div>
  </body>
</html>
